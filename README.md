# ヤマト運輸B2 CSV変換ツール

Yahoo!ショッピングの注文CSV（`order.csv`）を、ヤマト運輸のB2クラウドシステムに取り込み可能なCSV形式に変換するためのWebアプリケーションです。

## 主な機能

- **Webインターフェース**: ブラウザ上でCSVの変換、編集、ダウンロードが完結します。
- **ファイル対応**: Yahoo!ショッピングからダウンロードした元の `order.csv` (CP932)と、このツールで出力したUTF-8形式のCSVファイルの両方を読み込めます。
- **データ編集**: お客様管理番号、お届け先情報、品名など、主要なフィールドを画面上で直接編集できます。
- **一括編集**: 「出荷予定日」をカレンダーから選択し、すべての注文に一括で適用できます。
- **入力補助**: 「送り状種類」「配達時間帯」「荷扱い」などのフィールドは、ドロップダウンやコンボボックスから簡単に入力できます。
- **UTF-8出力**: 最終的なCSVファイルは、文字化けしにくく、Excelでも扱いやすいUTF-8形式でダウンロードされます。

## 設定

ご依頼主情報や請求先顧客コードなどの設定は、環境変数で行います。
プロジェクトのルートディレクトリに `.env` ファイルを作成し、必要な情報を記述してください。

1.  まず、`.env.example` ファイルをコピーして `.env` ファイルを作成します。
    ```bash
    cp .env.example .env
    ```

2.  `.env` ファイルをテキストエディタで開き、各項目にご自身の情報を設定します。
    ```dotenv
    # Flaskのセッション情報を暗号化するための秘密鍵（必須）
    # 例: openssl rand -hex 16 などで生成したランダムな文字列
    SECRET_KEY=

    # ご依頼主情報
    SENDER_PHONE=
    SENDER_ZIP=
    SENDER_ADDRESS=
    SENDER_NAME=

    # ヤマトB2クラウド用の設定
    BILLING_CUSTOMER_CODE=
    FREIGHT_MANAGEMENT_NUMBER=
    DEFAULT_ITEM_NAME=
    ```
    **注意:** `SECRET_KEY` は必ず設定してください。設定しない場合、アプリケーションは起動しません。

---

## セットアップと実行方法

このアプリケーションは、ローカル環境で直接実行する方法と、Dockerを使用して実行する方法の2通りがあります。

### 1. ローカル環境での実行

**前提条件:**
- Python 3.8以上

**手順:**
1.  `.env` ファイルを準備します（[設定](#設定)セクションを参照）。
2.  必要なPythonライブラリをインストールします。
    ```bash
    pip install -r requirements.txt
    ```
3.  Webアプリケーションを起動します。
    ```bash
    python app.py
    ```
4.  Webブラウザで以下のURLにアクセスします。
    [http://127.0.0.1:5001](http://127.0.0.1:5001)

### 2. Dockerを使用した実行

**前提条件:**
- Docker
- Docker Compose

**手順:**
1.  `.env` ファイルを準備します（[設定](#設定)セクションを参照）。
2.  ターミナルで以下のコマンドを実行して、コンテナをビルドし、起動します。
    ```bash
    docker-compose up --build
    ```
    （初回はビルドのため少し時間がかかります。2回目以降は `docker-compose up` だけでOKです。）

    `compose.yaml`で`env_file`がサポートされていない古いバージョンのDocker Composeをお使いの場合は、以下のようにして環境変数を渡すことができます。
    ```bash
    docker-compose run --rm --service-ports --env-file .env web
    ```

3.  Webブラウザで以下のURLにアクセスします。
    [http://127.0.0.1:5001](http://127.0.0.1:5001)

4.  アプリケーションを停止するには、ターミナルで `Ctrl + C` を押します。
